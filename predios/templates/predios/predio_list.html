{% extends 'base.html' %}
{% load static %}

{% block title %} Lista de Prédios {% endblock title %}

{% block head %}

    <!-- Footable CSS -->
    <link href="{% static '/assets/plugins/footable/css/footable.core.css' %}" rel="stylesheet">
    <!--alerts CSS -->
    <link href="{% static '/assets/plugins/sweetalert/sweetalert.css' %}" rel="stylesheet" type="text/css">

{% endblock head %}
    

{% block content %}

{% if messages %}
<div class="row page-titles">
    <div class="col-md-12 col-12 align-self-center">
    {% for message in messages %}

        <div class="alert alert-success">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close"> <span aria-hidden="true">&times;</span> </button>
        <h3 class="text-success"><i class="fa fa-check-circle"></i> Sucesso</h3> {{ message }}
        </div>

    {% endfor %}
    </div>
</div>
{% endif %}

<div class="row page-titles">
    <div class="col-md-6 col-8 align-self-center">
        <h3 class="text-themecolor m-b-0 m-t-0">Lista de Prédios</h3>
    </div>
</div>

<div class="card">
    <div class="card-block">
        <table id="demo-foo-addrow2" class="table table-bordered table-hover toggle-circle" data-page-size="10">
            <thead>
                <tr>
                    <th data-sort-initial="true" data-toggle="true">Nome</th>
                    <th data-hide="phone, tablet">Cidade</th>
                    <th data-hide="phone, tablet">Estado</th>
                    <th data-hide="phone, tablet">Pastor</th>
                    <th data-hide="phone, tablet">Tipo Igreja</th>
                    <th data-hide="phone, tablet">Idade</th>
                    <th data-sort-ignore="true" class="min-width">Ação</th>
                </tr>
            </thead>
            <div class="m-t-10">
                <div class="d-flex">
                    
                    <div class="ml-auto">
                        <div class="form-group">
                            <input id="demo-input-search2" type="text" placeholder="Pesquisar" class="form-control" autocomplete="off">
                        </div>
                    </div>
                </div>
            </div>
            {% if object_list %}
            <tbody>
                {% for p in object_list  %}
                <tr id="{{ p.id }}">
                    <td><a href="#">{{ p.nome }}</a></td>
                    <td>{{ p.cidade }}</td>
                    <td>{{ p.uf }}</td>
                    <td>{{ p.pastor.nome }}</td>
                    <td>{{ p.get_tipo_igreja_display }}</td>
                    <td>{{ p.idade }} anos</td>
                    <td>
                        <a class="btn btn-sm btn-icon btn-pure btn-outline delete-row-btn remove" data-nome="{{ p.nome }}" data-original-title="Apagar"><i class="ti-close" aria-hidden="true"></i></button>
                        <a class="btn btn-sm btn-icon btn-pure btn-outline edit-row-btn" href="#" data-original-title="Editar"><i class="ti-pencil" aria-hidden="true"></i></a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
            {% endif %}
            <tfoot>
                <tr>
                    <td colspan="7">
                        <div class="text-right">
                            <ul class="pagination">
                            </ul>
                        </div>
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>
</div>

{% block static %}

<!-- Footable -->
    <script src="{% static '/assets/plugins/footable/js/footable.all.min.js' %}"></script>
    <script src="{% static '/assets/plugins/bootstrap-select/bootstrap-select.min.js' %}" type="text/javascript"></script>
    <!--FooTable init-->
    <script src="{% static '/js/footable-init.js' %}"></script>
    <!-- Sweet-Alert  -->
    <script src="{% static '/assets/plugins/sweetalert/sweetalert.min.js' %}"></script>

    <script>
        $(".remove").click(function () {
            var id = $(this).parents("tr").attr("id");
            var nome = $(this).data("nome");
            swal({
                title: "Você tem certeza?",
                text: "Você não poderá mais recuperar o cadastro de " + nome,
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Sim, apagar",
                cancelButtonText: "Cancelar",
                closeOnConfirm: false
            }, function (isConfirm) {
                if (!isConfirm) return;
                $.ajax({
                    url: '/predios/delete/' + id,
                    type: 'POST',
                    success: function (data) {
                        swal("Apagado!", "O cadastro de " + nome + " foi apagado!", "success");
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        swal("Erro ao apagar!", "Tente de novo", "error");
                    }
                });
            });
        });
    </script>

{% endblock static %}
    

        
{% endblock content %}
    