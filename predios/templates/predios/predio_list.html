{% extends 'base.html' %}
{% load static %}

{% block title %} Lista de Prédios {% endblock title %}

{% block head %}

    <!-- Footable CSS -->
    <link href="{% static '/assets/plugins/footable/css/footable.core.css' %}" rel="stylesheet">
    <!--alerts CSS -->
    <link href="{% static '/assets/plugins/sweetalert/sweetalert.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static '/css/botoes.css' %}" rel="stylesheet">


{% endblock head %}
    

{% block content %}

{% if messages %}
<div class="row page-titles">
    <div class="col-md-12 col-12 align-self-center">
    {% for message in messages %}

        <div class="alert alert-success">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close"> <span aria-hidden="true">&times;</span> </button>
        <h3 class="text-success"><i class="fa fa-check-circle"></i> Sucesso</h3> {{ message }}
        </div>

    {% endfor %}
    </div>
</div>
{% endif %}

<div class="row page-titles">
    <div class="col-md-6 col-8 align-self-center">
        <h3 class="text-themecolor m-b-0 m-t-0">Lista de Prédios</h3>
    </div>
</div>

<div class="card">
    <div class="card-block">
        <table id="demo-foo-addrow2" class="table table-bordered table-hover toggle-circle" data-page-size="10">
            <thead>
                <tr>
                    <th data-sort-initial="true" data-toggle="true">Nome</th>
                    <th data-hide="phone, tablet">Cidade</th>
                    <th data-hide="phone, tablet">Estado</th>
                    <th data-hide="phone, tablet">Pastor</th>
                    <th data-hide="phone, tablet">Tipo Igreja</th>
                    <th data-hide="phone, tablet">Idade</th>
                    <th data-hide="phone, tablet">Situação</th>
                    <th data-sort-ignore="true" class="min-width">Ação</th>
                </tr>
            </thead>
            <div class="m-t-10">
                <div class="d-flex">
                    
                    <div class="ml-auto">
                        <div class="form-group">
                            <input id="demo-input-search2" type="text" placeholder="Pesquisar" class="form-control" autocomplete="off">
                        </div>
                    </div>
                </div>
            </div>
            {% if object_list %}
            <tbody>
                {% for p in object_list  %}
                <tr id="{{ p.id }}">
                    <td><a href="{% url 'predio-perfil' p.id %}">{{ p.nome }}</a></td>
                    <td>{{ p.cidade }}</td>
                    <td>{{ p.uf }}</td>
                    <td>{{ p.pastor.nome }}</td>
                    <td>{{ p.get_tipo_igreja_display }}</td>
                    <td>{{ p.idade }} anos</td>
                    <td>
                        {% if p.situacao == 'A' %}
                        <div class="label label-table label-success">{{ p.get_situacao_display }}</div>
                        {% else %}
                        <div class="label label-table label-danger">{{ p.get_situacao_display }}</div>
                        {% endif %}
                    </td>
                    <td>
                        <a class="btn btn-sm btn-icon btn-pure btn-outline remove" data-nome="{{ p.nome }}" data-original-title="Apagar"><i class="ti-close" aria-hidden="true"></i></a>
                        <a class="btn btn-sm btn-icon btn-pure btn-outline edit-row-btn" href="{% url 'predio-update' p.id %}" data-original-title="Editar"><i class="ti-pencil" aria-hidden="true"></i></a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
            {% endif %}
            <tfoot>
                <tr>
                    <td colspan="8">
                        <div class="text-right">
                            <ul class="pagination">
                            </ul>
                        </div>
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>
</div>

<div class="row">
    <nav class="container-botao">

        <a href="{% url 'predio-create' %}" class="buttons-botao btn-success" tooltip="Add Prédio"><i class="fa fa-plus my-float"></i></a>
        
      </nav>
</div>
{% block static %}

<!-- Footable -->
    <script src="{% static '/assets/plugins/footable/js/footable.all.min.js' %}"></script>
    <!--FooTable init-->
    <script src="{% static '/js/footable-init.js' %}"></script>
    <!-- Sweet-Alert  -->
    <script src="{% static '/assets/plugins/sweetalert/sweetalert.min.js' %}"></script>

    <script> 
        $('.remove').click(function() {
        var id = $(this).parents("tr").attr("id");
        var nome = $(this).data("nome");
        deleteMember(id, nome);
      });
    
      function deleteMember(id, nome) {
        swal({
          title: "Você tem certeza?", 
          text: "Você não poderá mais recuperar o cadastro de " + nome, 
          type: "warning",
          showCancelButton: true,
          showLoaderOnConfirm: true,
          closeOnConfirm: false,
          confirmButtonText: "Sim, apagar",
          confirmButtonColor: "#f62d51",
          cancelButtonText: "Cancelar"
        }, function() {
          $.ajax({
            url: '/predios/delete/' + id,
            type: "POST"
          })
          .done(function(data) {
            swal({
                title: "Apagado!", 
                text: "O cadastro de " + nome + " foi apagado!", 
                type: "success"
            },function() {
                location.href = "/predios/list/";
            });
          })
          .fail(function(xhr, ajaxOptions, thrownError) {
            swal("Oops", "Alguma coisa deu errada. Tente novamente!", "error");
          });
        });
      }
    </script>

{% endblock static %}
    

        
{% endblock content %}
    